<div class="breadcrumb">
    <h1>Pedidos</h1>
    <ul>
        <li>Ventas</li>
        <li>Pedidos</li>
    </ul>
</div>

<div class="separator-breadcrumb border-top"></div>

<div class="row mb-3">
    <div class="col-md-12 mb-3 d-flex justify-content-between align-items-center">
        <div class="col-md-4">
            <div class="form-group">
                <button class="btn btn-primary" [routerLink]="['/orders/new']">Crear nuevo Pedido</button>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <input id="role" placeholder="Buscar Pedido" [formControl]="searchControl" class="form-control"
                    type="role">
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <div class="card o-hidden">
            <ngx-datatable class="material fullscreen" style="height: 460px;" [columnMode]="'force'" [headerHeight]="50"
                [footerHeight]="50" [rowHeight]="60" [scrollbarV]="true" [rows]="listOrders" [externalPaging]="true"
                [count]="listOrders.length" [limit]="itemsPerPage" [offset]="(currentPage - 1) * itemsPerPage"
                (page)="onPageChange($event)">
                <ngx-datatable-column name="order_number" [resizeable]="false" [canAutoResize]="true" [maxWidth]="60">
                    <ng-template ngx-datatable-header-template>
                        <p style="font-size:10px;">N°</p>
                    </ng-template>
                    <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                        <ng-container *ngIf="row && row.id_order">
                            <p style="font-size:10px; text-align:center; margin-top:12px;">{{ row.order_number }}</p>
                        </ng-container>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="client" [resizeable]="false" [canAutoResize]="true" [maxWidth]="120">
                    <ng-template ngx-datatable-header-template>
                        <p style="font-size:10px;">Cliente</p>
                    </ng-template>
                    <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                        <ng-container *ngIf="row && row.id_order">
                            <p style="font-size:10px; text-align:center; margin-top:12px;">{{ row.id_client }}</p>
                        </ng-container>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="employee" [resizeable]="false" [canAutoResize]="true" [maxWidth]="120">
                    <ng-template ngx-datatable-header-template>
                        <p style="font-size:12px;">Empleado</p>
                    </ng-template>
                    <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                        <ng-container *ngIf="row && row.id_order">
                            <p style="font-size:10px; text-align:center; margin-top:12px;">{{ row.id_employee }}</p>
                        </ng-container>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="order_date" [resizeable]="false" [canAutoResize]="true" [maxWidth]="120">
                    <ng-template ngx-datatable-header-template>
                        <p style="font-size:12px;">Fecha de Pedido</p>
                    </ng-template>
                    <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                        <ng-container *ngIf="row && row.id_order">
                            <p style="font-size:10px; text-align:center; margin-top:12px;">{{ row.order_date }}</p>
                        </ng-container>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="order_state" [resizeable]="false" [canAutoResize]="true" [maxWidth]="120"> 
                    <ng-template ngx-datatable-header-template>
                        <p style="font-size:12px;">Estado de Pedido</p>
                    </ng-template>
                    <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                        <ng-container *ngIf="row && row.id_order">
                            <p style="font-size:10px; text-align:center; margin-top:12px;">{{ row.order_state }}</p>
                        </ng-container>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="delivery_state" [resizeable]="false" [canAutoResize]="true" [maxWidth]="120">
                    <ng-template ngx-datatable-header-template>
                        <p style="font-size:102x;">Estado de Entrega</p>
                    </ng-template>
                    <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                        <ng-container *ngIf="row && row.id_order">
                            <p style="font-size:10px; text-align:center; margin-top:12px;">{{ row.delivery_state }}</p>
                        </ng-container>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="payment_state" [resizeable]="false" [canAutoResize]="true" [maxWidth]="120">
                    <ng-template ngx-datatable-header-template>
                        <p style="font-size:12px;">Estado de Pago</p>
                    </ng-template>
                    <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                        <ng-container *ngIf="row && row.id_order">
                            <p style="font-size:10px; text-align:center; margin-top:12px;">{{ row.payment_state }}</p>
                        </ng-container>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="total_order" [resizeable]="false" [canAutoResize]="true" [maxWidth]="120">
                    <ng-template ngx-datatable-header-template>
                        <p style="font-size:12px; text-align: center;">Total Pedido</p>
                    </ng-template>
                    <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                        <ng-container *ngIf="row && row.id_order">
                            <p style="font-size:10px;  text-align:center; margin-top:12px;">{{ row.total_order }}</p>
                        </ng-container>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="actions" [resizeable]="false" [canAutoResize]="true" [maxWidth]="270">
                    <ng-template ngx-datatable-header-template>
                        <p style="font-size: 20px;">Acciones</p>
                    </ng-template>
                    <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                        <ng-container *ngIf="row && row.id_order" class="d-flex justify-content-center">
                            <button class="btn btn-dark m-1" [routerLink]="['/orders/detail', row.id_order]">
                                <i class="i-Eye" style="font-size: 15px;"></i>
                            </button>
                            <button class="btn btn-success m-1" [routerLink]="['/payments/new', row.id_order]">
                                <i class="i-Financial" style="font-size: 15px;"></i>
                            </button>
                            <button class="btn btn-warning m-1" (click)="openModal(row.id_role)">
                                <i class="i-Jeep" style="font-size: 15px;"></i>
                            </button>
                            <button class="btn btn-danger m-1" (click)="openModal(row.id_role)">
                                <i class="i-Close" style="font-size: 15px;"></i>
                            </button>
                            <button class="btn btn-warning m-1" [routerLink]="['returns/', row.id_order]" title="Devolver"  >
                                <i class="i-Close" style="font-size: 15px;"></i>
                            </button>
                        </ng-container>
                    </ng-template>
                </ngx-datatable-column>                
            </ngx-datatable>
        </div>
    </div>
</div>

<ng-template #deleteConfirmModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-title">Cambiar Estado del Rol</h4>
        <button type="button" class="close" aria-label="Close button" aria-describedby="modal-title"
            (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <p><strong>¿Está seguro de que desea inhabilitar este rol?</strong></p>

    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary btn-rounded"
            (click)="modal.dismiss('cancel')">Cancelar</button>
        <button type="button" ngbAutofocus class="btn btn-wide btn-danger btn-rounded"
            (click)="modal.close('Ok')">Aceptar</button>
    </div>
</ng-template>